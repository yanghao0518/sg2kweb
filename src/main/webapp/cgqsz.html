<!DOCTYPE html>
<html>
<head>
<title>传感器设置</title>
<meta charset="utf-8" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta http-equiv="Cache-Control" content="no-transform" />
</head>
<style type="text/css">
td {
	height: 30px;
}
</style>
<body>
	<form id="_form">
		<table width="800" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<!--  
				<td width="30%"><input type="button" name="button1" value="导入" /></td>
				-->
				<td width="30%"><input type="button" id="save" value="保存" /></td>
				<td width="40%"><input type="button" id="send" value="下传" /></td>
			</tr>
			<tr>
				<td>网关序列号</td>
				<td><input type="text" name="Gateway_Id" value="0x12abcdef" /></td>
				<input type="hidden" name="Upload_Sensor_Type" id="Upload_Sensor_Type" />
				<td><input type="checkbox" ctype="Upload_Sensor_Type" id="Upload_Sensor_Type0" checked="checked" />振动启动</td>
			</tr>
			<tr>
				<td>传感器序列号</td>
				<td><input type="text" name="Sensor_Id" value="0x12abcdef" /></td>
				<td><input type="checkbox" ctype="Upload_Sensor_Type" id="Upload_Sensor_Type1" />直流上传</td>
			</tr>

			<tr>
				<td>高通滤波</td>
				<td><select name="HP_Filter">
						<option value="0">无高通滤波</option>
						<option value="1">3HZ高通滤波</option>
						<option value="2" selected="selected">10HZ高通滤波</option>
				    </select>
				</td>
				<td><input type="checkbox" ctype="Upload_Sensor_Type"  id="Upload_Sensor_Type2"/>加速度上传</td>
			</tr>
			<tr>
				<td>X方向角度</td>
				<td><input type="text" name="X_Angle" value="0" /></td>
				<td><input type="checkbox"  ctype="Upload_Sensor_Type" id="Upload_Sensor_Type3" checked="checked" />速度上传</td>
			</tr>
			<tr>
				<td>特征值采集间隔</td>
				<td><select name="Sample_Character_Time">
						<option value="0">不上传</option>
						<option value="1">1分钟</option>
						<option value="2">5分钟</option>
						<option value="3">10分钟</option>
						<option value="4" selected="selected">30分钟</option>
						<option value="5">1小时</option>
						<option value="6">2小时</option>
						<option value="7">6小时</option>
						<option value="8">12小时</option>
						<option value="9">1天</option>
						<option value="10">2天</option>
				</select></td>
				<td rowspan="5"><input type="hidden" name="Upload_Wave_Type" id="Upload_Wave_Type" />
					 <input type="checkbox" id="Upload_Wave_Type0" ctype="Upload_Wave_Type" checked="checked" />波形上传<br> 
					 <input type="checkbox" id="Upload_Wave_Type1" ctype="Upload_Wave_Type"/>加速度X<br> 
					 <input type="checkbox" id="Upload_Wave_Type2" ctype="Upload_Wave_Type"/>加速度Y<br> 
					 <input type="checkbox" id="Upload_Wave_Type3" ctype="Upload_Wave_Type"/>加速度Z<br> 
					 <input type="checkbox" id="Upload_Wave_Type4" ctype="Upload_Wave_Type" checked="checked" />速度X<br>
					 <input type="checkbox" id="Upload_Wave_Type5" ctype="Upload_Wave_Type" checked="checked" />速度Y<br>
					 <input type="checkbox" id="Upload_Wave_Type6" ctype="Upload_Wave_Type" checked="checked" />速度Z<br>
				</td>
			</tr>
			<tr>
				<td>特征值上传间隔</td>
				<td><select name="Upload_Character_Time">
						<option value="0">不上传</option>
						<option value="1">1分钟</option>
						<option value="2">5分钟</option>
						<option value="3">10分钟</option>
						<option value="4">30分钟</option>
						<option value="5">1小时</option>
						<option value="6" selected="selected">2小时</option>
						<option value="7">6小时</option>
						<option value="8">12小时</option>
						<option value="9">1天</option>
						<option value="10">2天</option>
				</select></td>
			</tr>
			<tr>
				<td>波形上传间隔</td>
				<td><select name="Upload_Wave_Time">
						<option value="0">不上传</option>
						<option value="1">1分钟</option>
						<option value="2">5分钟</option>
						<option value="3">10分钟</option>
						<option value="4">30分钟</option>
						<option value="5">1小时</option>
						<option value="6">2小时</option>
						<option value="7">6小时</option>
						<option value="8">12小时</option>
						<option value="9" selected="selected">1天</option>
						<option value="10">2天</option>
						<option value="11">3天</option>
						<option value="12">1周</option>
				</select></td>
			</tr>
			<tr>
				<td>波形长度</td>
				<td><select name="Wave_long">
						<option value="0">512</option>
						<option value="1" selected="selected">1024</option>
						<option value="2">2048</option>
						<option value="3">4096</option>
						<option value="4">8192</option>
				</select></td>
			</tr>
			<tr id="sty2">
				<td>采样率</td>
				<td><select name="Sample_Frequency">
						<option value="1600">1600</option>
						<option value="800" selected="selected">800</option>
						<option value="400">400</option>
						<option value="200">200</option>
						<option value="100">100</option>
				</select></td>
			</tr>
			<tr>
				<td>环境温度差</td>
				<td><input type="text" name="Temperature_alarm_diff"
					value="3500" /></td>
				<!-- 
				<td><input type="checkbox" name="checkbox12" />和环境温度差报警</td>
				 -->
			</tr>
			<tr>
				<td>温度高高报警值</td>
				<td><input type="text" name="Temperature_alarm_HH" value="8000" /></td>
				<!--
				<td><input type="checkbox" name="checkbox13" />温度高高报警值</td>
				-->
			</tr>
			<tr>
				<td>温度变化量报警值</td>
				<td><input type="text" name="Temperature_alarm_Change"
					value="500" /></td>
			</tr>
			<tr>
				<td>加速度x方向高高报警值</td>
				<td><input type="text" name="Acc_X_alarm_HH" value="100" /></td>
				<!--
				<td><input type="checkbox" name="checkbox14" />加速度x方向高高报警</td>
				-->
			</tr>
			<tr>
				<td>加速度x方向高报警值</td>
				<td><input type="text" name="Acc_X_alarm_H" value="80" /></td>
			</tr>
			<tr>
				<td>加速度Y方向高高报警值</td>
				<td><input type="text" name="Acc_Y_alarm_HH" value="100" /></td>
				<!--
				<td><input type="checkbox" name="checkbox15" />加速度Y方向高高报警</td>
				-->
			</tr>
			<tr>
				<td>加速度Y方向高报警值</td>
				<td><input type="text" name="Acc_Y_alarm_H" value="80" /></td>
			</tr>
			<tr>
				<td>加速度Z方向高高报警值</td>
				<td><input type="text" name="Acc_Z_alarm_HH" value="100" /></td>
				<!--
				<td><input type="checkbox" name="checkbox16" />加速度Z方向高高报警</td>
				-->
			</tr>
			<tr>
				<td>加速度Z方向高报警值</td>
				<td><input type="text" name="Acc_Z_alarm_H" value="80" /></td>
			</tr>
			<tr>
				<td>速度x方向高高报警值</td>
				<td><input type="text" name="Speed_X_alarm_HH" value="100" /></td>
				<!--
				<td><input type="checkbox" name="checkbox17" />速度x方向高高报警</td>
				-->
			</tr>
			<tr>
				<td>速度x方向高报警值</td>
				<td><input type="text" name="Speed_X_alarm_H" value="80" /></td>
			</tr>
			<tr>
				<td>速度Y方向高高报警值</td>
				<td><input type="text" name="Speed_Y_alarm_HH" value="100" /></td>
				<!--
				<td><input type="checkbox" name="checkbox18" />速度Y方向高高报警</td>
				-->
			</tr>
			<tr>
				<td>速度Y方向高报警值</td>
				<td><input type="text" name="Speed_Y_alarm_H" value="80" /></td>
			</tr>
			<tr>
				<td>加速度Z方向高高报警值</td>
				<td><input type="text" name="Speed_Z_alarm_HH" value="100" /></td>
				<!--
				<td><input type="checkbox" name="checkbox19" />速度Z方向高高报警</td>
				-->
			</tr>
			<tr>
				<td>加速度Z方向高报警值</td>
				<td><input type="text" name="Speed_Z_alarm_H" value="80" /></td>
			</tr>
			<tr>
				<td>数据包原始数据</td>
				<td colspan="2"><textarea name="textarea1" cols="50" rows="5"></textarea></td>
			</tr>
		</table>
	</form>
</body>
<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="js/base.js"></script>
<script type="text/javascript" src="js/layer/layer.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
<script type="text/javascript" src="js/form.js"></script>
<script type="text/javascript">
	    function ityzl_SHOW_LOAD_LAYER(){
	   		return layer.msg('努力中...', {icon: 16,shade: [0.5, '#f5f5f5'],scrollbar: false,offset: '0px', time:100000}) ;
	   	}
	    var ityzl_index;
</script>
<script type="text/javascript">
	$(function() {
		
		
        var Upload_Sensor_Type_Checkbox = new baseCheckbox('Upload_Sensor_Type',8);
        var Upload_Wave_Type_Checkbox = new baseCheckbox('Upload_Wave_Type',16);
        
		var $form = new baseForm('_form');

		var onLoadSuccessCallBack = function(data){
			//处理
			var Upload_Sensor_Type = data.Upload_Sensor_Type;
			if(Upload_Sensor_Type){
				Upload_Sensor_Type_Checkbox.setValueBy10(Upload_Sensor_Type);
			}
			
			var Upload_Wave_Type = data.Upload_Wave_Type;
			if(Upload_Wave_Type){
				Upload_Wave_Type_Checkbox.setValueBy10(Upload_Wave_Type);
			}
		};
		
		$form.load('Test/getFirstSensorConfig.do',onLoadSuccessCallBack);
		
		
		var submitSuccessCallbackSave = function(result){
			if(result && result.code == 200){
				layer.alert('操作成功！');
			}else{
				layer.msg('保存失败!');
			}
			
		};
		
		var task;
		var taskId;
		var submitSuccessCallbackSend = function(result){
			//加载条需要加载上一次包序号
			if(result && result.code == 200){
				taskId = result.data;
				//每隔间断获取数据
				task = window.setInterval(refresh,5000); 
				
			}else{
				layer.msg('下发失败!');
			}
			
		};
		
       var taskrequest = new baseRequest('Test/getTaskResult.do', function(result){
    	   if(result && result.code == 200){
    		   var taskResult = result.data;
    		   //任务已经完成
    		   if(taskResult && taskResult.status == 1){
    			   layer.close(ityzl_index);
    			   var packageData = taskResult.packageData;
    			   if(packageData){
    				   var str = '';
    				   $.each(packageData,function(index,d){
    					   str = str + d;
    				   });
    				   $('textarea[name="textarea1"]').text(str);
    			   }else{
    				   layer.msg("获取下发网关配置失败!");
    			   }
    			   
    			   window.clearInterval(task);
    		   }
    	   }else{
    		   layer.close(ityzl_index);
    		   window.clearInterval(task);
    		   layer.msg("获取下发网关配置失败!");
    	   }
       },function(status){
    	   layer.close(ityzl_index);
    	   window.clearInterval(task);
    	   layer.msg("获取下发网关配置失败!");
    	   
       });
		
		var refresh = function() {
			taskrequest.send({taskId:taskId},function(){
				ityzl_index = ityzl_SHOW_LOAD_LAYER();
			});
		}; 
		
		//处理保存
		$('#save').click(function(){
			//处理隐藏域
			var str1 = Upload_Sensor_Type_Checkbox.getValueBy10();
			var str2 = Upload_Wave_Type_Checkbox.getValueBy10();
			$('#Upload_Sensor_Type').val(str1);
			$('#Upload_Wave_Type').val(str2);
			$form.save('Test/saveSensorConfig.do',submitSuccessCallbackSave);
			
		});
		
		//处理下发
		$('#send').click(function(){
			var str1 = Upload_Sensor_Type_Checkbox.getValueBy10();
			var str2 = Upload_Wave_Type_Checkbox.getValueBy10();
			$('#Upload_Sensor_Type').val(str1);
			$('#Upload_Wave_Type').val(str2);
			$form.save('Test/sendSensorConfig.do',submitSuccessCallbackSend);
		});
		
		
	});
</script>
</html>